<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Compliance Test Language (CTL)</title>
    <style type="text/css" media="screen,print">
    body {
      color: black;
      background: white;
      font-family: Georgia, serif;
    }
    h1, h2, h3 {
      font-family: Verdana, sans-serif;
      color: #000099;
      text-align: left;
    }
    h1 { font-size: 1.50em; }
    h2 { font-size: 1.25em; margin-top: 2em;}
    h3 { font-size: 1em; margin-top: 2em; }
    h4 { font-size: 0.9em; }
    h5 { margin-bottom: 0.5em; margin-top: 1.5em; }
    li { margin-bottom: 0.25em; }
    table {
      margin-bottom: 0.5em;
      width: 75%;
      border-collapse: separate;
    }
    td, th { padding: 0.25em; text-align: left}
    caption { text-align: left; }
    dt { 
      margin-top: 1em; 
      font-weight: bold ;
    }
    pre { background: WhiteSmoke; }
    pre.example { background: AliceBlue; }
    a:link img, a:visited img { border-style: none }
    div.header { margin-bottom: 2em; }
    ul.sourcelist { margin: 0.5em; }
    table.content-model th {
      font-size: 0.80em;
      font-family: verdana, sans-serif;
      background: #eeeeee;
      color: #000099;
    }
    table.revhistory {
      border-collapse: collapse;
    }
    table.revhistory th {
      font-size: 0.80em;
      font-family: verdana, sans-serif;
      text-align: left;
      background: #000099;
      color: white;
    }
    </style>
  </head>
  <body>
    <div class="header">
      <a href="http://sourceforge.net/projects/teamengine/">
        <img alt="Teamengine graphic" src="img/teamengine.png" />
      </a>
    </div>
    <h1>Compliance Test Language (CTL) 0.5</h1>
    
    <dl class="authorgroup">      
      <dt>Contributors:</dt>
      <dd>R. Martell</dd>
      <dd>Chuck Morris &lt;chuck |DOT| morris |AT| ngc |DOT| com&gt;</dd>
      <dd>J. Parr-Pearson</dd>
    </dl>
    
    <div class="purpose">
    <h3 id="purpose">Purpose</h3>
    <p>This document establishes Compliance Test Language, an XML grammar for 
    documenting and scripting suites of tests for verifying that an implementation 
    of a specification complies with the specification.</p>
    
    <p>This document does:</p>
    <ul>
        <li>Define the structure of a test suite and tests in the test suite.</li>
        <li>Define the elements that can be used to form the test script code.</li>
        <li>Define interfaces for producing Java classes to extend the basic CTL functionality.</li>
        <li>Provide informative examples test scripts and sample script output.</li>
        <li>Provide guidelines on terminology used to properly document tests.</li>
    </ul>

    <p>It does <strong>not</strong>:</p>
    <ul>
        <li>Define an interface for submitting tests to a test engine.</li>
        <li>Define a normative format for logging output from a test engine.</li>
        <li>Define a normative format for documentation generated from the test suite</li>
    </ul>
    </div>
    
    <div class="sources">
      <h3 id="sources">Related documents</h3>
      <ul>
        <li><a href="http://www.w3.org/TR/xslt20/">XSL Transformations (XSLT) Version 2.0</a> (W3C Recommendation, 2007-01-23)</li>
        <li><a href="http://www.w3.org/TR/xpath20/">XML Path Language (XPath) 2.0</a> (W3C Recommendation, 2007-01-23)</li>
        <li><a href="http://www.w3.org/TR/xpath-functions/">XQuery 1.0 and XPath 2.0 Functions and Operators</a> (W3C Recommendation, 2007-01-23)</li>
        <li><a href="http://www.w3.org/TR/html401/">HTML 4.01 Specification</a> (W3C Recommendation, 1999-12-24)</li>
        <li><a href="http://www.w3.org/TR/xhtml-basic/">XHTML Basic 1.1</a> (W3C Working Draft, 2006-07-05)</li>
      </ul>
    </div>

    <div class="revisions">
      <h3 id="revisions">Revision history</h3>
      <table class="revhistory" border="1" summary="Revision history">
        <tr>
          <th>Revision</th>
          <th>Date</th>
          <th>Comments</th>
        </tr>
        <tr>
          <td>0.5</td>
          <td>2007-06-15</td>
          <td>New capabilities documented: XInclude support; multi-part requests; ZipParser.</td>
        </tr>
        <tr>
          <td>0.4</td>
          <td>2006-09-06</td>
          <td>Submitted as OGC Discussion Paper</td>
        </tr>
      </table>
    </div>
    
    <div class="contents">
      <h2 id="toc">Contents</h2>
      <ol id="contents-ats" class="toc1">
        <li><a href="#overview">Overview of CTL</a></li>
        <li><a href="#package">Package</a></li>
        <li><a href="#objects">CTL Objects</a>
          <ol class="toc2">
            <li><a href="#suite">Suite</a></li>
            <li><a href="#test">Test</a></li>
            <li><a href="#function">Function</a></li>
            <li><a href="#parser">Parser</a></li>
          </ol>
        </li>
        <li><a href="#instructions">Instructions</a>
          <ol class="toc2">
            <li><a href="#form">form</a></li>
            <li><a href="#request">request</a></li>
            <li><a href="#call-test">call-Test</a></li>
            <li><a href="#for-each">for-Each</a></li>
            <li><a href="#message">message</a></li>
            <li><a href="#fail">fail</a></li>
            <li><a href="#call-func">call-function</a></li>
          </ol>
        </li>
        <li><a href="#parsers">Built-in parsers</a>
          <ol class="toc2">
            <li><a href="#parsers.intro">Introduction</a></li>
            <li><a href="#cdata">CDataParser</a></li>
            <li><a href="#http">HTTPParser</a></li>
            <li><a href="#xsd-validator">XMLValidatingParser</a></li>
          </ol>
        </li>
      </ol>
    </div>
    
    <div id="sect.overview">
    <h2 id="overview">1. Overview of CTL</h2>
    <p>A test suite in CTL consists of a set of objects. The initial object is a 
    suite, which identifies a starting test. The starting test contains instructions 
    that may call other tests or use functions and parsers. See Figure 1 below.</p>
    
    <h5 id="fig-1">Figure 1: Structure of a CTL test suite</h5>
    <p><img alt="Test suite components" src="img/ctl_fig1.gif" /></p>
    
    <p>A CTL file is an XML file that contains a CTL object or a package element 
    as its root element. The package element, which is a container for multiple 
    CTL objects, is described in detail in section 7. Each CTL object is identified 
    by a unique, namespace qualified name, so the set of objects in a test suite 
    may span several files. The CTL objects are described in section 8.</p>
    
    <p>Test objects contain programmatic code that consists of XSL instructions 
    and/or CTL instructions. The CTL instructions are described in section 9.</p>
  
    <p>Some parser objects are built-in to CTL, and may be used without declaring 
    a parser object. The built-in parsers are described in section 10.</p>
    
    </div>
    
    <div id="sect.package">
    <h2 id="package">2. Package</h2>
    
    <h3 id="package.intro">2.1 Introduction</h3>
    
    <p>The &lt;package&gt; element is a container for CTL objects or traditional 
    XSL templates. Each CTL object is complete on its own and may be placed in 
    its own file, or several objects may be placed in a package for the convenience 
    of grouping them in the same file.</p>
    
    <h3 id="package.encoding">2.2 Encoding</h3>
    <pre>
&lt;ctl:package xmlns:ctl="http://www.occamlab.com/ctl"
  (tns:<em>anyAttribute</em> xmlns:tns="##other")?>

  &lt;xi:include xmlns:xi="http://www.w3.org/2001/XInclude" /> *
  &lt;ctl:suite /> *
  &lt;ctl:test /> *
  &lt;ctl:package /> *
  &lt;ctl:parser /> *
  &lt;ctl:function /> *
  &lt;xsl:template xmlns:xsl="http://www.w3.org/1999/XSL/Transform" /> *

&lt;/ctl:package></pre>
<!--    
    <table id="package-content" class="content-model" frame="box">
      <tbody>
        <tr>
          <th>Element/Attribute</th>
          <th>Usage</th>
          <th>Description</th>
        </tr>
        <tr>
          <td><code>&lt;package&gt;</code></td>
          <td>Required</td>
          <td>Establishes a package</td>
        </tr>
        <tr>
          <td>&nbsp;<code>&lt;<em>suite|test|function|parser|xsl:template</em> /&gt;</code></td>
          <td>Optional<sup>*</sup></td>
          <td>CTL Objects</td>
        </tr>
        <tr>
          <td><code>&lt;/package&gt;</code></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3">
          <h5>Usage Notes:</h5>
          <sup>*</sup> May be repeated.
          </td>
        </tr>
      </tbody>
    </table>
-->    
    </div>
    
    <div id="sect-objects">
    <h2 id="objects">3. CTL Objects</h2>
    
    <h3 id="suite">3.1 Suite</h3>
    <h4 id="suite.intro">3.1.1 Introduction</h4>
    <p>The &lt;suite&gt; element establishes a set of tests. It names a test suite, 
    describes its purpose, and identifies the starting test where processing 
    begins when the test suite is executed.</p>
    
    <h4 id="suite.encoding">3.1.2 Encoding</h4>
    <pre>
&lt;suite <strong>name</strong>="xsd:QName" xmlns="http://www.occamlab.com/ctl">
  &lt;title>Test suite title&lt;/title>
  &lt;description>The purpose of the test suite&lt;/description> ?
  &lt;starting-test>xsd:QName&lt;/starting-test>
&lt;/suite></pre>
 

    <h4 id="suite.example">3.1.3 Example</h4>
    <pre class="example">
&lt;ctl:suite name="example:suite"&gt;
  &lt;ctl:title&gt;Example Test Suite&lt;/ctl:title&gt;
  &lt;ctl:description&gt;
  Tests compliance to the Example Service Implementation Specification, version 1.0
  &lt;/ctl:description&gt;
  &lt;ctl:starting-test&gt;example:main&lt;/ctl:starting-test&gt;
&lt;/ctl:suite&gt;</pre>

    <h3 id="test">3.2 Test</h3>
    <h4 id="test.intro">3.2.1 Introduction</h4>
    <p>The &lt;test&gt; element establishes an individual test. It states an 
    assertion and contains program code to test the assertion.</p>
    
    <h4 id="test.encoding">3.2.2 Encoding</h4>
    <pre>
&lt;test <strong>name</strong>="xsd:QName" xmlns="http://www.occamlab.com/ctl">
  &lt;param <strong>name</strong>="xsd:string">Parameter description&lt;/param> *
  &lt;context>Describes the calling context&lt;/context> ?
  &lt;assertion>Condition or system state to be verified&lt;/assertion>
  &lt;comments>comment&lt;/comments> *
  &lt;link title="xsd:string">xsd:anyURI&lt;/link> *
  &lt;code>
    <span style="color: blue;">&lt;!-- one or more instructions --></span>
  &lt;/code>
&lt;/test></pre>
    
    <h4 id="test.descriptions">3.2.3 Element descriptions</h4>
    <h5 id="test.param">3.2.3.1 param</h5>
    <p>Tests may have zero or more parameters specified as &lt;param&gt; elements, 
    named with a name attribute. The content of the element should describe the 
    parameter.</p>
    
    <h5 id="test.context">3.2.3.2 context</h5>
    <p>When a test is executed, there is always an XML tree in memory, and a 
    current node within the tree. This is known as the context. In some cases, 
    the context in which a test is called is important, while in other cases in 
    may not matter. If the test code depends on the context, the test should 
    describe the proper context state with a &lt;context&gt; element.</p>
    
    <h5 id="test.assertion">3.2.3.3 assertion</h5>
    <p>The &lt;assertion&gt; element specifies the test assertion. The assertion 
    is a statement derived from the specification being tested which is true for 
    a valid implementation.</p> 
    
    <p>The assertion may contain references to the labels 
    of the parameters or the context by using {$name} notation. For example, 
    {$context} refers to the current context label, and {$p1} refers to the 
    label of the parameter named “p1”. The value of the label may evaluate to 
    the content of the &lt;context&gt; or &lt;param&gt; element, or the value 
    of the label or label-expr attribute on the &lt;for-each&gt; or &lt;with-param&gt; 
    elements, depending on whether documentation is being generated or whether 
    the test is actually being executed.</p>
    
    <p>In some cases, the assertion text may be vague if read in isolation, 
    but its meaning should be clear when viewed in the context of the assertion 
    of the calling test. For example, the assertion “A summary is present” is 
    vague, but if the assertion of the parent test is “HTML tables are properly 
    formatted”, then it is clear that the test looks for a summary on an HTML 
    table.</p>
    
    <h5 id="test.comments">3.2.3.4 comments</h5>
    <p>The &lt;comments&gt; element allows documentation of additional comments 
    on the purpose of the test or method of verification. The comments should 
    apply to the test as a whole. Of course, XML comments inside &lt;!-- --&gt; 
    tags may also be used, but this comment tag is more formal and may be used 
    in documentation.</p>
    
    <h5 id="test.link">3.2.3.5 link</h5>
    <p>Zero or more &lt;link&gt; elements may be used to provide links back to 
    the place or places in the specification where the assertion was derived 
    from.</p>
    
    <h5 id="test.code">3.2.3.6 code</h5>
    <p>The &lt;code&gt; element contains the programmatic code used to verify 
    the assertion. Any XML is allowed in the code element. It should contain 
    CTL instructions and/or XSL instructions for evaluation by a test engine. 
    The test will pass unless one or more &lt;fail&gt; instructions are executed.</p>
    
    <h4 id="test.example">3.2.4 Example</h4>
    <pre class="example">
&lt;ctl:test name="example:zulu">
  &lt;ctl:param name="time">time string&lt;/ctl:param>
  &lt;ctl:assertion>
  If the hours field is included in {$time}, the suffix Z (for zulu) is required.
  &lt;/ctl:assertion>
  &lt;ctl:link>wms:B.2.1&lt;/ctl:link>
  &lt;ctl:code>
    &lt;xsl:if test="contains($time, 'T')">
      &lt;xsl:variable name="len" select="string-length($time)"/>
      &lt;xsl:if test="not(substring($time, $len) = 'Z')">
        &lt;ctl:fail/>
      &lt;/xsl:if>
    &lt;/xsl:if>
  &lt;/ctl:code>
&lt;/ctl:test></pre>

    <h3 id="function">3.3 Function</h3>
    <h4 id="function.intro">3.3.1 Introduction</h4>
    <p>The &lt;function&gt; element is used to declare user-defined functions 
    or external java functions. These functions may be called as XPath functions 
    in instructions that use ${XPath-expression}s, or they may be called directly 
    with the &lt;call-function&gt; instruction.</p>
    
    <h4 id="function.encoding">3.3.2 Encoding</h4>
    <pre>
&lt;ctl:function <strong>name</strong>="xsd:QName" xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;ctl:description>Function description&lt;/ctl:description> ?
  &lt;ctl:param name="xsd:string">Parameter description&lt;/ctl:param> *
  <span style="color: blue;">&lt;!-- var-params only applies to a Java-based function --></span>
  &lt;ctl:var-params <strong>min</strong>="xsd:int" <strong>max</strong>="xsd:int" /> ?
  &lt;ctl:context>Describes the calling context&lt;/ctl:context> ?
  &lt;ctl:return>Describes what the function returns&lt;/ctl:return> ?
  &lt;ctl:comments>Comments about the function&lt;/ctl:comments> *
  <span style="color: blue;">&lt;!-- choose either ctl:code or ctl:java --></span>
  &lt;ctl:code>
    <span style="color: blue;">&lt;!-- one or more instructions --></span>
  &lt;/ctl:code>
  &lt;ctl:java <strong>class</strong>="xsd:string" <strong>method</strong>="xsd:string" initialized="xsd:boolean">
    <span style="color: blue;">&lt;!-- initialization parameters --></span>
    &lt;ctl:with-param name="xsd:string" select="<em>${XPath-expression}</em>"?> *
      <span style="color: blue;">&lt;!-- literal XML content if @select is absent --></span>
    &lt;ctl:with-param>
  &lt;/ctl:java>
&lt;/ctl:function></pre>

    <h4 id="function.descriptions">3.3.3 Element descriptions</h4>
    <h5 id="function.param">3.3.3.1 param</h5>
    <p>Functions may have zero or more parameters specified as &lt;param&gt; 
    elements, named with a name attribute. The content of the element should 
    describe the parameter.</p>
    
    <h5 id="function.var-params">3.3.3.2 var-params</h5>
    <p>Some functions implemented as Java methods may be called with a variable 
    number of parameters. This optional element indicates that a variable number 
    of parameters is allowed. It has attributes <code>min</code> and <code>max</code>, 
    indicating the maximum and minimum number of parameters allowed.</p>
    
    <h5 id="function.context">3.3.3.3 context</h5>
    <p>When a function is executed, there is always an XML tree in memory, and 
    a current node within the tree. This is known as the context. In some cases, 
    the context in which a function is called is important, while in other cases 
    in may not matter. If the function code depends on the context, it should 
    describe the proper context state with a &lt;context&gt; element.</p>
    
    <h5 id="function.return">3.3.3.4 return</h5>
    <p>The optional &lt;return&gt; element should be used to provide a brief 
    description of what the function returns.</p>
    
    <h5 id="function.description">3.3.3.5 description</h5>
    <p>The optional &lt;description&gt; element is used to describe the 
    function.</p>
    
    <h5 id="function.comment">3.3.3.6 comment</h5>
    <p>Functions may contain zero or more &lt;comment&gt; elements.</p>
    
    <h5 id="function.code">3.3.3.7 code</h5>
    <p>The &lt;code&gt; element is required unless a &lt;java&gt; element is 
    supplied. Any XML is allowed in the code element. It should contain CTL 
    instructions and/or XSL instructions implementing the function.</p>
    
    <h5 id="function.java">3.3.3.8 java</h5>
    <p>The &lt;java&gt; element is required unless a &lt;code&gt; element is 
    supplied. It indicates the function is implemented as an external Java 
    method. It contains class and method attributes that identify the Java class 
    and method.</p>
    
    <p>For a java method to be used, it must be implemented as a public method. 
    If the method is not static, this must be indicated by setting the <code>initialized</code> 
    attribute to "true". This will initialize the class, calling the class 
    constructor (which also must be public) by passing it the parameter values 
    supplied by the optional &lt;with-param&gt; elements.</p>
    
    <p>There are restrictions on the parameter types that may be used in the 
    Java method and the class constructor. They must be one of the built-in 
    primitive types (boolean, char, byte, short, int, long, float, double), 
    String, org.w3c.dom.Node, or org.w3c.dom.NodeList.</p>
    
    <p>If there is a &lt;context&gt; element, it must be the first parameter in 
    the method and must be of type org.w3c.dom.Node or org.w3c.dom.NodeList.</p>
    
    <p>The method may return a primitive type value, or a value of type String, 
    org.w3c.dom.Node, or org.w3c.dom.NodeList.</p>
    
    <h4 id="function.example">3.3.4 Examples</h4>
    <pre class="example">
&lt;function name="example:add" xmlns="http://www.occamlab.com/ctl">
  &lt;description>Adds two numbers&lt;/description>
  &lt;param name="num1">First Number&lt;/param>
  &lt;param name="num2">Second Number&lt;/param>
  &lt;return>num1 + num2&lt;/return>
  &lt;code>
    &lt;xsl:value-of xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
      select="$num1 + $num2" />
  &lt;/code>
&lt;/function>

&lt;function name="example:sqrt" xmlns="http://www.occamlab.com/ctl">
  &lt;description>Calculates a square root&lt;/description>
  &lt;param name="num"/>
  &lt;return>the square root of num&lt;/return>
  &lt;java class="java.lang.Math" method="sqrt"/>
&lt;/function></pre>

    <h3 id="parser">3.4 Parser</h3>
    <h4 id="parser.intro">3.4.1 Introduction</h4>
    <p>The &lt;parser&gt; element is used to declare a parser and link it to an 
    external Java implementation. Parsers are used in the &lt;request&gt; 
    instruction to convert the response from a web service into well-formed XML 
    for processing.</p>
    
    <h4 id="parser.encoding">3.4.2 Encoding</h4>
    <pre>
&lt;ctl:parser <strong>name</strong>="xsd:QName" xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;ctl:description>Parser description&lt;/ctl:description> ?
  &lt;ctl:comments>Comments about the parser&lt;/ctl:comments> *
  &lt;ctl:java <strong>class</strong>="xsd:string" <strong>method</strong>="xsd:string" initialized="xsd:boolean">
    <span style="color: blue;">&lt;!-- initialization parameters --></span>
    &lt;ctl:with-param name="xsd:string" select="<em>${XPath-expression}</em>"?> *
      <span style="color: blue;">&lt;!-- literal XML content if @select is absent --></span>
    &lt;ctl:with-param>
  &lt;/ctl:java>
&lt;/ctl:parser></pre>

    <h4 id="parser.descriptions">3.4.3 Element descriptions</h4>
    <h5 id="parser.description">3.4.3.1 description</h5>
    <p>The optional &lt;description&gt; element is used to describe the parser.</p>

    <h5 id="parser.comment">3.4.3.2 comment</h5>
    <p>Parsers may contain zero or more &lt;comment&gt; elements.</p>
    
    <h5 id="parser.java">3.4.3.3 java</h5>
    <p>The required &lt;java&gt; element contains class and method attributes 
    that identify the Java class and method. The Java method used must be 
    implemented as a public method. If the method is not static, this must be 
    indicated by setting the <code>initialized</code> attribute to "true"; this 
    will initialize the class, calling the class constructor (which also must 
    be public) by passing it the parameter values supplied by the optional 
    &lt;with-param&gt; elements.</p>
    
    <p>Parser methods must contain three parameters. The first is of type 
    <code>java.net.URLConnection</code> and contains the URLConnection object 
    used to make the web service request. The second is of type <code>org.w3c.Element</code>, 
    and contains an a copy of the parser element. The third is of type <code>java.io.PrintWriter</code> 
    and can be used to write messages to the log. The parser method should 
    return an XML document of type org.w3c.Document containing parsed XML, 
    a String, or null if it encounters an error.</p>
    </div>
    
    <div id="sect.instructions">
    <h2 id="instructions">4. Instructions</h2>
    
    <h3 id="form">4.1 Form</h3>
    <h4 id="form.intro">4.1.1 Introduction</h4>
    <p>The &lt;form&gt; instruction is used to retrieve user input. A Swing- or 
    XHTML-based form is generated and presented to the user. The user may the 
    fill in the fields on the form and press a submit button. The instruction 
    returns the values of the form fields and the button that was pressed.</p>
    
    <h4 id="form.encoding">4.1.2 Encoding</h4>
    <p>The form instruction may contain a combination of literal XML elements 
    and/or other CTL or XSL instructions. When any enclosed instructions have 
    been evaluated, the resulting XML shall conform to this encoding.</p>
    <pre>
&lt;ctl:form xmlns:ctl="http://www.occamlab.com/ctl" 
  height="xsd:positiveInteger" width="xsd:positiveInteger">
  <span style="color: blue;">&lt;!-- XHTML Basic markup --></span>
&lt;/ctl:form></pre>

    <h4 id="form.descriptions">4.1.3 Element and attribute descriptions</h4>
    <h5 id="form.size">4.1.3.1 size</h5>
    <p>The form element contains height and width attributes, used to specify 
    the desired height and width of the form in pixels. The user agent should 
    regard these as hints on the size of window required, but does not have to 
    follow these guidelines.</p>
    
    <h5 id="form.xhtml">4.1.3.2 XHTML Basic elements</h5>
    <p>The content of the form should evaluate into <a href="http://www.w3.org/TR/xhtml-basic/">XHTML 
    Basic</a> elements. All of the XHTML Basic elements valid inside the XHTML 
    Basic &lt;form&gt; element are supported, with the exception of the &lt;object&gt; 
    element.</p>
    
    <p>Of particular interest are the XHTML Basic elements that define form 
    controls: &lt;input&gt;, &lt;select&gt;, and &lt;textarea&gt;. These elements 
    can be used to define user options that the form will return. The form must 
    contain at least one &lt;input type="submit"&gt; element to allow the user 
    to submit the form.</p>
    
    <h4 id="form.results">4.1.4 Results</h4>
    <p>When the user presses a submit button on the form, the instruction completes. 
    It returns the user input as a set of key-value pairs, where the key corresponds 
    to a control name and the value corresponds to the control value. A key-value 
    pair is generated only for successful controls, as formally defined in 
    <a href="http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2">section 
    17.13.2</a> of the HTML 4.01 specification.</p>

    <p>The resulting form data set shall conform to this encoding:</p>
    <pre>
&lt;values>
  &lt;value <strong>key</strong>="xsd:string"><em>xsd:string</em>&lt;/value> *
&lt;/values></pre>

    <h4 id="form.example">4.1.5 Example</h4>
    <p>The following form will be displayed to the user graphically as shown in 
    Figure 2.</p>
    <pre class="example">
&lt;ctl:form xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;p>
    &lt;img src="http://www.google.com/intl/en/images/logo.gif"/>&lt;br/>
    Do you see the Google logo?&lt;br/>
    &lt;input type="submit" name="answer" value="yes"/>
    &lt;input type="submit" name="answer" value="no"/>
  &lt;/p>
&lt;/ctl:form></pre>

    <h5 id="fig-2">Figure 2: Rendering of ctl:form content</h5>
    <p><img alt="Form" src="img/ctl_fig2.png" /></p>

    <p>If the user presses the "yes" button, the results will look like this:</p>
    <pre class="example">
&lt;values>
  &lt;value key="answer">yes&lt;/value>
&lt;/values></pre>
    
    <h3 id="request">4.2 Request</h3>
    <h4 id="request.intro">4.2.1 Introduction</h4>
    <p>The &lt;request&gt; element submits an HTTP request to a web service or 
    other resource, and returns an XML representation of the response.</p>
    
    <h4 id="request.encoding">4.2.2 Encoding</h4>
    <p>The request instruction may contain a combination of literal XML elements 
    and/or other CTL or XSL instructions. When any enclosed instructions have 
    been evaluated, the resulting XML shall conform to the following encoding.</p>
    <pre>
&lt;ctl:request xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;ctl:url><em>xsd:anyURI</em>&lt;/ctl:url>
  &lt;ctl:method>[GET | POST | HEAD]&lt;/ctl:method>
  &lt;ctl:param <strong>name</strong>="xsd:string"><em>xsd:string</em>&lt;/ctl:param> *
  &lt;ctl:body> ?
    <span style="color: blue;">&lt;!-- text/plain or application/xml entity (POST only) --></span>
  &lt;/ctl:body>
  &lt;ctl:parser /> ?
&lt;/ctl:request></pre>

    <h4 id="request.descriptions">4.2.3 Element and attribute descriptions</h4>
    <h5 id="request.url">4.2.3.1 url</h5>
    <p>The required &lt;url&gt; element indicates the web service or other HTTP 
    resource where the request will be submitted.</p>
    
    <h5 id="request.method">4.2.3.2 method</h5>
    <p>The required &lt;method&gt; element indicates the HTTP method that will 
    be used to make the request. Supported method types are get, post, and head.</p>
    
    <h5 id="request.param">4.2.3.3 param</h5>
    <p>Optional &lt;param&gt; elements may be included to supply CGI parameters 
    for the request. The CGI parameters are added to the URL before the request 
    is sent.</p>
    
    <h5 id="request.body">4.2.3.4 body</h5>
    <p>The &lt;body&gt; element is used only for requests where the method is 
    set to "POST". It contains the data to post when the request is sent. The 
    element may contain character data (text/plain media type), which is passed 
    on directly, or XML (application/xml media type) which is serialized and 
    then passed on.</p>
    
    <h5 id="request.parser">4.2.3.5 parser</h5>
    <p>A parser may be used to instruct the engine how to convert the response 
    from the request into an XML representation. If present, the name of this 
    element should correspond to the name attribute of a parser element (see 
    <a href="#parser">section 3.4</a>). Parsers may contain various required or 
    optional attributes or elements, depending on the parser implementation. 
    See <a href="#fixme">section FIXME</a> for the correct encoding for built-in 
    parsers.</p>
    
    <h4 id="request.results">4.2.4 Results</h4>
    <p>The request element returns an XML representation of the response, as 
    generated by the parser. If no parser element is present and the response 
    is well-formed XML, the XML is returned. Otherwise, nothing is returned.</p>
    
    <h4 id="request.example">4.2.5 Example</h4>
    <pre class="example">
&lt;request xmlns="http://www.occamlab.com/ctl">
  &lt;url>http://some.host.org/wms&lt;/url>
  &lt;method>GET&lt;/method>
  &lt;param name="SERVICE">WMS&lt;/param>
  &lt;param name="REQUEST">GetCapabilities&lt;/param>
  &lt;param name="VeRsIoN">1.1.1&lt;/param>
&lt;/request></pre>
    
    <h3 id="call-test">4.3 Call-Test</h3>
    <h4 id="call-test.intro">4.3.1 Introduction</h4>
    <p>The call-test instruction executes a sub-test.</p>
    
    <h4 id="call-test.encoding">4.3.2 Encoding</h4>
    <pre>
&lt;ctl:call-test <strong>name</strong>="xsd:QName" xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;ctl:with-param <strong>name</strong>="xsd:string" 
    label="xsd:string" 
    label-expr="<em>${XPath-expression}</em>" 
    select="<em>${XPath-expression}</em>"?> *
    <span style="color: blue;">&lt;!-- literal value if @select is absent --></span> *
  &lt;/ctl:with-param>
&lt;/ctl:call-test></pre>

    <h4 id="call-test.descriptions">4.3.3 Element and attribute descriptions</h4>
    <h5 id="call-test.name">4.3.3.1 Attribute: name</h5>
    <p>The name attribute identifies the test to execute, and corresponds to 
    the name of a &lt;test&gt; element as described in <a href="#test">section 3.2.</a></p>
    
    <h5 id="call-test.with-param">4.3.3.2 Element: with-param</h5>
    <p>If the test to be called contains parameters, values for the parameters 
    may be supplied using &lt;with-param&gt; elements. It is similar to the 
    &lt;xsl:with-param&gt; instruction, but it supports two additional attributes. 
    The optional <code>label</code> attribute is used for documentation purposes, 
    to describe what is being passed to the subtest in the current instance of 
    the call-test instruction. The optional <code>label-expr</code> attribute 
    is an ${XPath-expression} that is calculated at run time to generate a label 
    for the parameter. This value is substituted into the assertion text if the 
    assertion text contains a reference to the parameter.</p>
    
    <h4 id="call-test.results">4.3.4 Results</h4>
    <p>This instruction does not generate any content, but it will pass on 
    failures from the subtest. In other words, if the subtest fails, the 
    failure bubbles up the call stack, and parent tests will also fail.</p>
    
    <h4 id="call-test.example">4.3.5 Examples</h4>
    <pre class="example">
&lt;ctl:call-test name="example:subtest" xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;ctl:with-param name="param1" select=".//table[1]" 
    label="The first table" 
    label-expr="concat('Table titled ', caption)"/>
&lt;/ctl:call-test>

&lt;xsl:for-each select=".//table">
  &lt;ctl:call-test name="example:subtest">
    &lt;ctl:with-param name="param1" label="Each table" 
              label-expr="concat('Table titled ', caption)">
      &lt;xsl:value-of select="."/>
    &lt;/ctl:with-param>
  &lt;/ctl:call-test>
&lt;/xsl:for-each></pre>
    
    <h3 id="for-each">4.4 For-each</h3>
    <h4 id="for-each.intro">4.4.1 Introduction</h4>
    <p>The for-each instruction loops through each node in a node-set, making 
    it the current node and processing the instructions in the for-each 
    instruction body. It is identical to the &lt;xsl:for-each&gt; instruction, 
    except that it allows setting labels with the label and label-expr attributes.</p>
    
    <h4 id="for-each.encoding">4.4.2 Encoding</h4>
    <pre>
&lt;ctl:for-each xmlns:ctl="http://www.occamlab.com/ctl"
  <strong>select</strong>="<em>${XPath-expression}</em>"  
  label="xsd:string" 
  label-expr="<em>${XPath-expression}</em>">
    <span style="color: blue;">&lt;!-- one or more instructions --></span>
&lt;/ctl:for-each></pre>

    <h4 id="for-each.descriptions">4.4.3 Element and attribute descriptions</h4>
    <h5 id="for-each.select">4.4.3.1 Attribute: select</h5>
    <p>The required select attribute shall specify an ${XPath-expression} that 
    evaluates to a node-set.</p>
    
    <h5 id="for-each.label">4.4.3.2 Attribute: label</h5>
    <p>The optional label attribute is used for documentation purposes. It 
    describes the context for any enclosed call-test instructions.</p>
    
    <h5 id="for-each.label-expr">4.4.3.3 Attribute: label-expr</h5>
    <p>The optional label-expr attribute is an ${XPath-expression} that is 
    calculated at run time to generate a label for the context. This value is 
    substituted into the assertion text of any subtests that contains a reference 
    to the context.</p>
    
    <h5 id="for-each.instructions">4.4.3.4 Content: instructions</h5>
    <p>The body of the for-each instruction shall contain CTL instructions 
    and/or XSL instructions. These instructions are processed for each node 
    in the node-set specified by the select attribute, using that node as the 
    current node.</p>

    <h4 id="for-each.results">4.4.4 Results</h4>
    <p>Returns any XML returned by processing the enclosed instructions.</p>
    
    <h4 id="for-each.example">4.4.5 Example</h4>
    <pre class="example">
&lt;ctl:for-each xmlns:ctl="http://www.occamlab.com/ctl" 
  select=".//table" 
  label="Each table"
  label-expr="concat('Table titled ', caption)">
  &lt;ctl:call-test name="example:subtest" />
&lt;/for-each></pre>

    <h3 id="message">4.5 Message</h3>
    <h4 id="message.intro">4.5.1 Introduction</h4>
    <p>The message instruction presents a message to the user. For instance, it 
    may be used to describe what is wrong when a test fails. It may also be 
    useful for debugging purposes when tests are in the development stage.</p>
    
    <p>The message may be supplied as an ${XPath-expression} using the select 
    attribute or it may be provided as the body of the element. In either case, 
    the message presented to the user will be the string value of the selected 
    nodes.</p>
    
    <h4 id="message.encoding">4.5.2 Encoding</h4>
    <pre>
&lt;ctl:message xmlns:ctl="http://www.occamlab.com/ctl" select="<em>${XPath-expression}</em>">
    <span style="color: blue;">&lt;!-- message text if @select is absent --></span>
&lt;/ctl:message></pre>
    
    <h4 id="message.descriptions">4.5.3 Element and attribute descriptions</h4>
    <h5 id="message.select">4.5.3.1 Attribute: select</h5>
    <p>The optional select attribute specifies an ${XPath-expression}. If present, 
    the message will be generated by evaluating the expression and converting 
    it to a string.</p>
    
    <h5 id="message.content">4.5.3.2 Content: message</h5>
    <p>If there is no <code>select</code> attribute, the content of the message 
    instruction specifies the message. It may contain mixed content, including 
    character data and other instructions. When any enclosed instructions have 
    been evaluated, the result is converted to a string to generate the message.</p>

    <h4 id="message.results">4.5.4 Results</h4>
    <p>This instruction does not generate any content.</p>
    
    <h4 id="message.example">4.5.5 Examples</h4>
    <pre class="example">
&lt;ctl:message xmlns:ctl="http://www.occamlab.com/ctl" select="concat(’Table ’, caption)" />

&lt;ctl:message xmlns:ctl="http://www.occamlab.com/ctl">Table &lt;xsl:value-of select="caption"/>&lt;/ctl:message>
</pre>

    <h3 id="fail">4.6 Fail</h3>
    <h4 id="fail.intro">4.6.1 Introduction</h4>
    <p>The fail instruction is used to indicate that a test has failed.</p>
    
    <h4 id="fail.encoding">4.6.2 Encoding</h4>
    <pre>
&lt;ctl:fail xmlns:ctl="http://www.occamlab.com/ctl" /></pre>
    
    <h4 id="fail.results">4.6.3 Results</h4>
    <p>The instruction does not generate any content. When the test processor 
    encounters the fail instruction, it indicates that the test has failed. 
    However, this does not halt test execution. The rest of the instructions 
    will continue to be processed, including any subsequent calls to subtests, 
    but regardless of their results the current test will fail.</p>
    
    <h4 id="fail.example">4.6.4 Examples</h4>
    <pre class="example">
&lt;xsl:if test="not(2 + 2 = 4)">
  &lt;ctl:message>[FAILURE] Addition error: expected 2 + 2 = 4&lt;/ctl:message>
  &lt;ctl:fail />
&lt;/xsl:if></pre>

    <h3 id="call-func">4.7 Call-Function</h3>
    <h4 id="call-func.intro">4.7.1 Introduction</h4>
    <p>The call-function instruction invokes a named function.</p>
    
    <h4 id="call-func.encoding">4.7.2 Encoding</h4>
    <pre>
&lt;ctl:call-function <strong>name</strong>="xsd:QName" xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;ctl:with-param name="xsd:string" select="<em>${XPath-expression}</em>"> *
    <span style="color: blue;">&lt;!-- parameter value if @select is absent --></span>
  &lt;/ctl:with-param>
&lt;/ctl:call-function></pre>

    <h4 id="call-func.descriptions">4.7.3 Element and attribute descriptions</h4>
    <h5 id="call-func.name">4.7.3.1 Attribute: name</h5>
    <p>The name attribute identifies the function to execute, and corresponds 
    to the name of a &lt;function&gt; element as described in <a href="#function">
    section 3.3</a>.</p>
    
    <h5 id="call-func.with-param">4.7.3.2 Element: with-param</h5>
    <p>If the test to be called contains parameters, values for the parameters 
    may be supplied using &lt;with-param&gt; elements. Parameters must be passed 
    in order. If the optional name attribute is specified, it must match the 
    parameter in the corresponding position in the function definition is named, 
    the names must match. As with the &lt;xsl:with-param&gt; instruction, the parameter 
    value may be specified as an XPath expression using the select attribute 
    or it may be specified using the content of the with-param element.</p>
    
    <h4 id="call-func.results">4.7.4 Results</h4>
    <p>This instruction returns the value of the function call.</p>
    
    <h4 id="call-func.example">4.7.5 Examples</h4>
    <pre class="example">
&lt;ctl:call-function name="example:myfunction" xmlns:ctl="http://www.occamlab.com/ctl">
  &lt;with-param select="$param1"/>
  &lt;with-param>&lt;param2-value/>&lt;/with-param>
&lt;/call-function></pre>
    </div>
    
    <div id="sect.parsers">
    <h2 id="parsers">5. Built-in parsers</h2>
    
    <h3 id="parsers.intro">5.1 Introduction</h3>
    <p>This section describes several parser objects that are built-in to 
    Compliance Test Language and shall be supported by test processors. Tests 
    can use these parsers without declaring them.</p>
    
    <h3 id="cdata">5.2 CDataParser</h3>
    <h4 id="cdata.intro">5.2.1 Introduction</h4>
    <p>The <code>CDataParser</code> is a parser that parses the content into 
    character data.</p>
    
    <h4 id="cdata.encoding">5.2.2 Encoding</h4>
    <pre>&lt;ctlp:CDataParser xmlns:ctlp="http://www.occamlab.com/te/parsers" /></pre>

    <h3 id="http">5.3 HTTPParser</h3>
    <h4 id="http.intro">5.3.1 Introduction</h4>
    <p>The <code>HTTPParser</code> is a parser that returns HTTP header information 
    uses other parser(s) to parse the content. It supports multipart messages.</p>
    
    <h4 id="http.encoding">5.3.2 Encoding</h4>
    <pre>
&lt;ctlp:HTTPParser xmlns:ctlp="http://www.occamlab.com/te/parsers">
  &lt;ctlp:parse part="xsd:positiveInteger" mime="<em>${media-type}</em>"> *
    <span style="color: blue;">&lt;!-- parser instruction --></span> ?
  &lt;/ctlp:parse>
&lt;/ctlp:HTTPParser></pre>

    <h4 id="http.results">5.3.3 Results</h4>
    <h5 id="http.standard">5.3.3.1 Standard media types</h5>
    <p>If the Content-Type header of the message is not multipart, the results 
    shall conform to the following encoding:</p>

    <pre>
&lt;response>
  &lt;status <strong>protocol</strong>="${protocol-version}" <strong>code</strong>="${status-code}">
    ${status-message}
  &lt;/status>
  &lt;headers>
    &lt;header <strong>name</strong>="${header-name}"> *
      ${header-value}
    &lt;/header>
  &lt;/headers>
  &lt;content> ?
    <span style="color: blue;">&lt;!-- message body (XML entity) --></span> ?
  &lt;/content>
&lt;/response></pre>

    <h5 id="http.multipart">5.3.3.2 Multi-part media types</h5>
    <p>If the Content-Type header of the message is multipart, the results shall 
    conform to the following encoding:</p>

    <pre>
&lt;multipart-response>
  &lt;status <strong>protocol</strong>="${protocol-version}" <strong>code</strong>="${status-code}">
    ${status-message}
  &lt;/status>
  &lt;headers
    &lt;header <strong>name</strong>="${header-name}"> *
      ${header-value}
    &lt;/header>
  &lt;/headers>
  &lt;part <strong>num</strong>="xsd:positiveInteger"> *
    &lt;headers>
      &lt;header <strong>name</strong>="${header-name}"> *
        ${header-value}
      &lt;/header>
    &lt;/headers>
    &lt;content> ?
      <span style="color: blue;">&lt;!-- XML entity --></span> ?
    &lt;/content>
  &lt;/part>
&lt;/multipart-response></pre>

    <h3 id="xsd-validator">5.4 XMLValidatingParser</h3>
    <h4 id="xsd-validator.intro">5.4.1 Introduction</h4>
    <p>The <code>XMLValidatingParser</code> is a parser that parses data as XML 
    and validates it against one or more XML Schemas.</p>

    <h4 id="xsd-validator.encoding">5.4.2 Encoding</h4>
    <pre>
&lt;ctlp:XMLValidatingParser xmlns:ctlp="http://www.occamlab.com/te/parsers" 
  ignoreErrors="xsd:boolean" ignoreWarnings="xsd:boolean">
  &lt;ctlp:schemas> ?
    &lt;ctlp:schema type="[URL | File | Resource]"> +
      ${schema-location} <span style="color: blue;">&lt;!-- required if @type is present --></span>
    &lt;/ctlp:schema>
  &lt;/ctlp:schemas>
&lt;/ctlp:XMLValidatingParser></pre>

    <h4 id="xsd-validator.results">5.4.3 Results</h4>
    <p>The <code>XMLValidatingParser</code> attempts to parse the data stream 
    returned by a request into XML, and validates the XML against each of the 
    XML Schemas. Any validation errors and warnings are presented to the user. 
    If there are no errors or warnings, or if errors and warning are ignored, 
    the parser returns the XML. If the data stream cannot be parsed or there 
    are errors or warnings that are not ignored, no content is returned.</p>

    <h4 id="xsd-validator.example">5.4.4 Example</h4>
    <pre class="example">
&lt;xsl:variable name="results" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:ctl="http://www.occamlab.com/ctl"
  xmlns:ctlp="http://www.occamlab.com/te/parsers">

  &lt;ctl:request>
    &lt;ctl:url>http://www.example.com/example.xml&lt;/ctl:url>
    &lt;ctl:method>GET&lt;/ctl:method>
    &lt;ctlp:XMLValidatingParser>
      &lt;ctlp:schemas>
        &lt;ctlp:schema type="url">http://www.example.com/example.xsd&lt;/ctlp:schema>
      &lt;/ctlp:schemas>
    &lt;/ctlp:XMLValidatingParser>
  &lt;/ctl:request>
&lt;/xsl:variable>

&lt;xsl:if test="not($results/*)">
  &lt;ctl:message>[FAILURE} Parsing or validation errors.&lt;/ctl:message>
&lt;/xsl:if></pre>
    </div>
  </body>
</html>